'use client';

import React from 'react';
import { Polygon, LayerGroup, Popup } from 'react-leaflet';

// Тип для исторического периода
interface HistoricalPeriod {
  id: string;
  name: string;
  year: number;
  endYear?: number;
  borders: [number, number][][];
  color: string;
  description: string;
}

interface HistoricalBordersLayerProps {
  selectedYear?: number;
}

// Детализированные полигоны границ для различных исторических периодов
const historicalPeriods: HistoricalPeriod[] = [
  {
    id: 'kievan_rus_early',
    name: 'Ранняя Киевская Русь (862-1054)',
    year: 862,
    endYear: 1054,
    borders: [
      // Приблизительные границы ранней Киевской Руси
      [
        [55.75, 37.62], // Москва
        [59.93, 30.31], // Санкт-Петербург
        [54.69, 25.28], // Вильнюс
        [52.42, 31.03], // Гомель
        [50.45, 30.52], // Киев
        [46.47, 30.71], // Одесса
        [48.47, 35.04], // Харьков
        [52.42, 31.03], // Гомель
        [55.75, 37.62], // Москва
      ]
    ],
    color: '#FFD700', // Gold
    description: 'Восточнославянское государство в период единства'
  },
  {
    id: 'kievan_rus_late',
    name: 'Поздняя Киевская Русь (1054-1240)',
    year: 1054,
    endYear: 1240,
    borders: [
      // Приблизительные границы поздней Киевской Руси до нашествия монгол
      [
        [55.75, 37.62], // Москва
        [59.93, 30.31], // Санкт-Петербург
        [54.69, 25.28], // Вильнюс
        [52.42, 31.03], // Гомель
        [50.45, 30.52], // Киев
        [46.47, 30.71], // Одесса
        [48.47, 35.04], // Харьков
        [52.42, 31.03], // Гомель
        [55.75, 37.62], // Москва
      ]
    ],
    color: '#FFA500', // Orange
    description: 'Восточнославянское государство в период феодальной раздробленности'
  },
  {
    id: 'mongol_invasion',
    name: 'Монгольские владения (1240-1480)',
    year: 1240,
    endYear: 1480,
    borders: [
      // Приблизительные границы Золотой Орды
      [
        [60.0, 45.0], // Северная точка
        [55.0, 65.0], // Восточная точка
        [45.0, 75.0], // Юго-восточная точка
        [38.0, 60.0], // Южная точка
        [40.0, 40.0], // Юго-западная точка
        [50.0, 30.0], // Западная точка
        [60.0, 45.0], // Северная точка
      ]
    ],
    color: '#8B000', // Dark Red
    description: 'Монгольское государство в Восточной Европе'
  },
  {
    id: 'moscow_principality',
    name: 'Великое княжество Московское (1480-1547)',
    year: 1480,
    endYear: 1547,
    borders: [
      // Приблизительные границы Московского княжества
      [
        [60.0, 30.0], // Северо-запад
        [62.0, 40.0], // Север
        [55.0, 50.0], // Восток
        [50.0, 45.0], // Юго-восток
        [45.0, 40.0], // Юг
        [48.0, 30.0], // Юго-запад
        [55.0, 25.0], // Запад
        [60.0, 30.0], // Северо-запад
      ]
    ],
    color: '#4682B4', // Steel Blue
    description: 'Русское государство с центром в Москве'
  },
  {
    id: 'tsardom_russia',
    name: 'Царство Русское (1547-1721)',
    year: 1547,
    endYear: 1721,
    borders: [
      // Приблизительные границы Российского царства
      [
        [65.0, 30.0], // Северо-запад
        [68.0, 45.0], // Север
        [60.0, 60.0], // Восток
        [50.0, 65.0], // Юго-восток
        [45.0, 60.0], // Юг
        [48.0, 40.0], // Юго-запад
        [55.0, 25.0], // Запад
        [65.0, 30.0], // Северо-запад
      ]
    ],
    color: '#1E90FF', // Dodger Blue
    description: 'Государство под властью русских царей'
  },
  {
    id: 'russian_empire',
    name: 'Российская империя (1721-1917)',
    year: 1721,
    endYear: 1917,
    borders: [
      // Приблизительные границы Российской империи в разные периоды
      [
        [70.0, 20.0], // Северо-запад
        [75.0, 60.0], // Северо-восток
        [70.0, 100.0], // Восток
        [60.0, 120.0], // Юго-восток
        [50.0, 130.0], // Юго-восток
        [40.0, 120.0], // Юг
        [35.0, 100.0], // Юго-запад
        [40.0, 80.0], // Запад
        [45.0, 60.0], // Северо-запад
        [50.0, 40.0], // Северо-запад
        [55.0, 25.0], // Запад
        [70.0, 20.0], // Северо-запад
      ]
    ],
    color: '#006400', // Dark Green
    description: 'Империя, охватывавшая значительную часть Евразии'
  },
  {
    id: 'ussr_early',
    name: 'ССР (1922-1945)',
    year: 1922,
    endYear: 1945,
    borders: [
      // Приблизительные границы СССР до Второй мировой войны
      [
        [70.0, 20.0], // Северо-запад
        [75.0, 60.0], // Северо-восток
        [70.0, 100.0], // Восток
        [60.0, 120.0], // Юго-восток
        [50.0, 130.0], // Юго-восток
        [40.0, 120.0], // Юг
        [35.0, 100.0], // Юго-запад
        [40.0, 80.0], // Запад
        [45.0, 60.0], // Северо-запад
        [50.0, 40.0], // Северо-запад
        [55.0, 25.0], // Запад
        [70.0, 20.0], // Северо-запад
      ]
    ],
    color: '#8B008B', // Dark Magenta
    description: 'Союз Советских Социалистических Республик (ранний период)'
  },
  {
    id: 'ussr_late',
    name: 'СССР (1945-1991)',
    year: 1945,
    endYear: 1991,
    borders: [
      // Приблизительные границы СССР после Второй мировой войны
      [
        [70.0, 20.0], // Северо-запад
        [75.0, 60.0], // Северо-восток
        [70.0, 100.0], // Восток
        [60.0, 120.0], // Юго-восток
        [50.0, 130.0], // Юго-восток
        [40.0, 120.0], // Юг
        [35.0, 100.0], // Юго-запад
        [40.0, 80.0], // Запад
        [45.0, 60.0], // Северо-запад
        [50.0, 40.0], // Северо-запад
        [55.0, 25.0], // Запад
        [70.0, 20.0], // Северо-запад
      ]
    ],
    color: '#DC143C', // Crimson
    description: 'Союз Советских Социалистических Республик (послевоенный период)'
  },
  {
    id: 'russian_federation',
    name: 'Российская Федерация (1991-наст. время)',
    year: 1991,
    borders: [
      // Современные границы Российской Федерации
      [
        [77.44, 19.62], // Северо-западная точка
        [71.17, 156.25], // Северо-восточная точка
        [41.19, 144.58], // Юго-восточная точка
        [46.86, 142.34], // Юго-восточная точка
        [43.19, 131.87], // Юго-восточная точка
        [41.19, 134.23], // Юго-восточная точка
        [41.19, 46.42], // Южная точка
        [46.71, 33.84], // Юго-западная точка
        [48.19, 22.13], // Юго-западная точка
        [52.38, 20.97], // Западная точка
        [54.52, 19.58], // Северо-западная точка
        [77.44, 19.62], // Северо-западная точка
      ]
    ],
    color: '#1E90FF', // Dodger Blue
    description: 'Современная Российская Федерация'
  }
];

// Компонент для анимации изменения границ
const HistoricalBordersLayer = ({ selectedYear }: HistoricalBordersLayerProps) => {
  // Определяем активный период на основе выбранного года
  const activePeriod = historicalPeriods.find(period =>
    selectedYear !== undefined && selectedYear >= period.year && (period.endYear ? selectedYear < period.endYear : true)
  );

  if (!activePeriod) {
    return null; // Don't render if no active period found
  }

  return (
    <LayerGroup>
      <Polygon
        positions={activePeriod.borders}
        pathOptions={{
          color: activePeriod.color,
          fillColor: activePeriod.color,
          fillOpacity: 0.2,
          weight: 2
        }}
      >
        <Popup>
          <div>
            <h3 className="font-bold">{activePeriod.name}</h3>
            <p className="text-sm">{activePeriod.year} - {activePeriod.endYear || 'наст. время'}</p>
            <p className="text-xs mt-1">{activePeriod.description}</p>
          </div>
        </Popup>
      </Polygon>
    </LayerGroup>
  );
};

export default HistoricalBordersLayer;